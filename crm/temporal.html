{% extends "administration/core/base.html" %}

{% block title %} {{ titulo }} {% endblock %}

{% block content %}

<h1 class="text-xl">Update Lead {{ lead }} {{ lead.name }}</h1>

<form action="." method="post" class="">
    {% csrf_token %}
    <div class="row mb-3">
        <div class="col-md-8">
            <label for="formGroupExampleInput2" class="form-label">Lead Nombre</label>
            {{ form.lead_name }}
        </div>
    </div>
    <div class="row mb-3">
        <div class="col-md-5">
            <label for="formGroupExampleInput2" class="form-label">Nombre</label>
            {{ form.first_name }}
        </div>
        <div class="col-md-5">
            <label for="formGroupExampleInput2" class="form-label">Apellido</label>
            {{ form.last_name }}
        </div>
    </div>
    <div class="row mb-3">
        <div class="col-md-5">
            <label for="formGroupExampleInput2" class="form-label">Currency</label>
            {{ form.currency }}
        </div>
        <div class="col-md-5">
            <label for="formGroupExampleInput2" class="form-label">Email</label>
            {{ form.primary_email }}
            {% if form.errors.primary_email %}
            <div id="email-error" class="text-danger">{{ form.errors.primary_email }}</div>
            {% endif %}
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-md-4">
            <label for="formGroupExampleInput2" class="form-label">Start Date</label>
            {{ form.start_date_time }}
        </div>
        <div class="col-md-4">
            <label for="formGroupExampleInput2" class="form-label">End Date</label>
            {{ form.end_date_time }}
        </div>
        <div class="col-md-4" {% if hide_extended_end_date_time %}style="display:none;" {% endif %}>
            <label for="formGroupExampleInput2" class="form-label">Extended End Date</label>
            {{ form.extended_end_date_time }}
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-md-4">
            <label for="formGroupExampleInput2" class="form-label">Country</label>
            {{ form.country }}
        </div>

    </div>

    <div class="row mb-3">
        <div class="col-md-5">
            <label for="formGroupExampleInput2" class="form-label">Assigned to</label>
            {{ form.assigned_to }}
        </div>
    </div>

    <div class="row mb-3">
        {{ formset.management_form }}
        <div id="form-list">
            {% for form in formset %}
            <div class="lead-product-form">{{ form.as_p }}</div>
            {% endfor %}
        </div>
        <div class="col-md-5">
            <button type="button" id="add-more" class="btn btn-primary">Agregar Producto</button> {# Botón para añadir
            más formularios #}
        </div>
    </div>

    <!-- LeadProductForm oculto para crear uno nuevo con JS -->
    <span id="lead-info" data-stage="{{ lead.stage }}" data-is-closed="{{ lead.is_closed }}"
        style="display: none;"></span>
    <span id="form-index" data-form-index="{{ formset.total_form_count }}" style="display: none;"></span>
    <div id="form-template" style="display: none;">
        {{ formset.empty_form.as_p }}
    </div>


    <div class="row mb-3">
        <div class="col-md-5">
            <label for="formGroupExampleInput2" class="form-label">Stage</label>
            {{ form.stage }}
        </div>
    </div>

    <br>
    <button type="submit" class="btn btn-primary" {% if not enable_update %}disabled{% endif %}>Update</button>
    <br><br><br>
</form>

<!-- Imprimir lead.pk y organization_name para depuración -->
<p>Debug: Lead ID ({{ lead.pk }}), Organization Name ({{ organization_name }})</p>


<!-- Botón para añadir una nueva task al lead -->
<div class="row mb-3">
    <div class="col text-end">
        <a href="{% url 'lead:task-create' pk=lead.pk organization_name=organization_name %}"
            class="btn btn-warning {% if not task_create %}disabled{% endif %}" {% if not task_create %}onclick="return false;" {% endif %}>Agregar Task</a>
    </div>
</div>



{% endblock %}


